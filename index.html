<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Clock In / Out</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont;
  background: linear-gradient(180deg,#0f2027,#203a43,#2c5364);
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}
.card {
  width:100%;
  max-width:360px;
  background:rgba(0,0,0,.35);
  padding:24px;
  border-radius:16px;
}
button {
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  font-weight:600;
}
.primary { background:#00e676; color:#000; }
.secondary { background:#ff5252; color:#fff; }
#controls { display:none; }
#status { margin-top:12px; text-align:center; }
</style>
</head>

<body>
<div class="card">
<h1>Clock In / Out</h1>

<div id="login">
  <input id="email" type="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<div id="controls">
  <button class="primary" onclick="clockIn()">Clock In</button>
  <button class="secondary" onclick="clockOut()">Clock Out</button>
  <div id="status"></div>
</div>

<button id="logoutBtn" onclick="logout()" style="display:none;margin-top:12px;">
  Log out
</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCnzBdlGPviltn6P8pID14lgkXHx6zQifA",
  authDomain: "clock-in-out-56209.firebaseapp.com",
  projectId: "clock-in-out-56209",
  storageBucket: "clock-in-out-56209.appspot.com",
  messagingSenderId: "285481914024",
  appId: "1:285481914024:web:4efcca9a9c476fec9f3c9d"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

function login() {
  auth.signInWithEmailAndPassword(
    email.value,
    password.value
  ).catch(e => alert(e.message));
}

auth.onAuthStateChanged(async user => {
  if (!user) {
    login.style.display="block";
    controls.style.display="none";
    logoutBtn.style.display="none";
    return;
  }

  login.style.display="none";
  controls.style.display="block";
  logoutBtn.style.display="block";

  const doc = await db.collection("users").doc(user.uid).get();
  if (doc.exists && doc.data().status==="in") {
    showIn(doc.data().since.toDate().toLocaleTimeString());
  } else {
    showOut();
  }
});

function showIn(t){ 
  document.querySelector(".primary").style.display="none";
  document.querySelector(".secondary").style.display="block";
  status.innerText=`CLOCKED IN since ${t}`;
}
function showOut(){
  document.querySelector(".primary").style.display="block";
  document.querySelector(".secondary").style.display="none";
  status.innerText="CLOCKED OUT";
}

async function clockIn(){
  const now=new Date();
  await db.collection("logs").add({
    uid:auth.currentUser.uid,
    type:"in",
    time:now
  });
  await db.collection("users").doc(auth.currentUser.uid).set({
    email:auth.currentUser.email,
    status:"in",
    since:now
  },{merge:true});
  showIn(now.toLocaleTimeString());
}

async function clockOut(){
  const now=new Date();
  await db.collection("logs").add({
    uid:auth.currentUser.uid,
    type:"out",
    time:now
  });
  await db.collection("users").doc(auth.currentUser.uid).set({
    email:auth.currentUser.email,
    status:"out"
  },{merge:true});
  showOut();
}

function logout(){
  auth.signOut().then(()=>location.reload());
}
</script>
</body>
</html>